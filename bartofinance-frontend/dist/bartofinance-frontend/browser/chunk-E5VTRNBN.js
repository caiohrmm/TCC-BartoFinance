import{a as st}from"./chunk-OXNNHE2V.js";import{a as mt}from"./chunk-YSZTBGHV.js";import{b as z,c as m,d as U,e as Q,g as Z,h as H,i as Y,j as J,k as K,l as W,m as X,n as tt,o as et,p as it,q as at,s as nt}from"./chunk-FV3EXO43.js";import{a as pt,b as ut}from"./chunk-JRTYZLGQ.js";import{a as ct}from"./chunk-M6ST4CNU.js";import{a as G}from"./chunk-RJRCW5OO.js";import{a as rt,b as lt,c as dt}from"./chunk-33YX74SX.js";import{$ as p,A as R,E as g,F as h,Ja as $,N as l,O as A,Qa as q,Sa as B,Ta as j,U as f,W as _,Wa as ot,Y as D,_ as w,a as M,b as k,ca as I,da as V,ea as n,fa as e,ga as E,ha as T,ia as C,ja as s,na as a,oa as v,pa as b,qa as F,wa as N,ya as P}from"./chunk-CFGVTO76.js";var _t=[{value:"CDB",label:"CDB",icon:"\u{1F3E6}",description:"Certificado de Dep\xF3sito Banc\xE1rio"},{value:"TESOURO_DIRETO",label:"Tesouro Direto",icon:"\u{1F3DB}\uFE0F",description:"Tesouro Direto"},{value:"ACOES",label:"A\xE7\xF5es",icon:"\u{1F4C8}",description:"A\xE7\xF5es"},{value:"FUNDOS",label:"Fundos",icon:"\u{1F4BC}",description:"Fundos de Investimento"},{value:"CRIPTOMOEDAS",label:"Criptomoedas",icon:"\u20BF",description:"Criptomoedas"},{value:"OUTROS",label:"Outros",icon:"\u{1F4CA}",description:"Outros"}],xt=[{value:"ATIVA",label:"Ativa",color:"green",icon:"\u2713",description:"Aplica\xE7\xE3o Ativa"},{value:"RESGATADA",label:"Resgatada",color:"blue",icon:"\u{1F4B0}",description:"Aplica\xE7\xE3o Resgatada"},{value:"ENCERRADA",label:"Encerrada",color:"gray",icon:"\u25A0",description:"Aplica\xE7\xE3o Encerrada"}];var O=(i,d)=>d.value,Ct=(i,d)=>d.id,ft=i=>["/investidores",i];function vt(i,d){i&1&&(n(0,"div",15),E(1,"span",18),n(2,"p",19),a(3,"Carregando detalhes..."),e()())}function gt(i,d){if(i&1&&(n(0,"span",50),a(1),e()),i&2){let t=s().$implicit;l(),F(" ",t.icon," ",t.label," ")}}function ht(i,d){if(i&1&&_(0,gt,2,2,"span",50),i&2){let t=d.$implicit,o=s(2);p(0,o.tipo===t.value?0:-1)}}function Et(i,d){i&1&&I(0,ht,1,1,null,null,O),i&2&&V(d)}function bt(i,d){if(i&1&&(n(0,"span"),a(1),e()),i&2){let t=s().$implicit;w("badge bg-"+t.color+"-100 text-"+t.color+"-800"),l(),F(" ",t.icon," ",t.label," ")}}function At(i,d){if(i&1&&_(0,bt,2,4,"span",51),i&2){let t=d.$implicit,o=s(2);p(0,o.risco===t.value?0:-1)}}function St(i,d){i&1&&I(0,At,1,1,null,null,O),i&2&&V(d)}function Dt(i,d){if(i&1&&(n(0,"p",29),a(1),e()),i&2){let t=s();l(),v(t.descricao)}}function Tt(i,d){if(i&1&&(n(0,"div",30)(1,"span",12),a(2,"Investidor:"),e(),n(3,"a",52),a(4),e()()),i&2){let t=d;l(3),D("routerLink",P(2,ft,t.id)),l(),b(" ",t.nome," ")}}function Ft(i,d){i&1&&(n(0,"div",53)(1,"div",54)(2,"span",55),a(3,"\u{1F4CB}"),e(),n(4,"div")(5,"h4",56),a(6,"Carteira Modelo"),e(),n(7,"p",57),a(8," Esta \xE9 uma carteira modelo (template) sem investidor vinculado. As aplica\xE7\xF5es cadastradas aqui servem como refer\xEAncia. Ao vincular um investidor, voc\xEA poder\xE1 definir os valores reais dos investimentos. "),e()()()())}function yt(i,d){if(i&1){let t=T();n(0,"div",49)(1,"p",58),a(2,"\u{1F4CA}"),e(),n(3,"p",59),a(4,"Nenhuma aplica\xE7\xE3o registrada."),e(),n(5,"p",60),a(6,"Comece adicionando uma aplica\xE7\xE3o nesta carteira."),e(),n(7,"button",61),C("click",function(){g(t);let r=s(3);return h(r.abrirModalAplicacao())}),a(8," Adicionar Primeira Aplica\xE7\xE3o "),e()()}}function wt(i,d){if(i&1&&(n(0,"span",71),a(1),e()),i&2){let t=d;l(),F(" ",t.icon," ",t.label," ")}}function It(i,d){if(i&1&&(n(0,"span"),a(1),e()),i&2){let t=d;w("badge bg-"+t.color+"-100 text-"+t.color+"-800"),l(),F(" ",t.icon," ",t.label," ")}}function Vt(i,d){if(i&1&&(n(0,"div",40),a(1),e()),i&2){let t=s().$implicit,o=s(4);l(),v(o.formatarData(t.dataVenda))}}function Mt(i,d){if(i&1){let t=T();n(0,"button",75),C("click",function(){g(t);let r=s().$implicit,c=s(4);return h(c.abrirModalAplicacao(r))}),a(1," \u270F\uFE0F "),e(),n(2,"button",76),C("click",function(){g(t);let r=s().$implicit,c=s(4);return h(c.abrirModalEncerrar(r))}),a(3," \u{1F512} "),e()}}function kt(i,d){if(i&1){let t=T();n(0,"tr",68)(1,"td",69)(2,"div")(3,"div",70),a(4),e(),n(5,"div",43),a(6),e()()(),n(7,"td",69),_(8,wt,2,2,"span",71),e(),n(9,"td",69)(10,"div",72),a(11),e()(),n(12,"td",69)(13,"div",72),a(14),e()(),n(15,"td",69)(16,"div"),a(17),e(),n(18,"div",43),a(19),e()(),n(20,"td",69),_(21,It,2,4,"span",51)(22,Vt,2,1,"div",40),e(),n(23,"td",73),_(24,Mt,4,0),n(25,"button",74),C("click",function(){let r=g(t).$implicit,c=s(4);return h(c.abrirModalExclusao(r))}),a(26," \u{1F5D1}\uFE0F "),e()()()}if(i&2){let t,o,r=d.$implicit,c=s(4);l(4),v(r.codigoAtivo),l(2),v(c.formatarData(r.dataCompra)),l(2),p(8,(t=c.getTipoProdutoInfo(r.tipoProduto))?8:-1,t),l(3),v(c.formatarValor(r.valorAplicado)),l(3),v(r.quantidade),l(2),w(r.rentabilidadeAtual>=0?"text-sm font-medium text-green-600":"text-sm font-medium text-red-600"),l(),b(" ",c.formatarPercentual(r.rentabilidadeAtual)," "),l(2),b(" ",c.formatarValor(c.calcularLucro(r))," "),l(2),p(21,(o=c.getStatusInfo(r.status))?21:-1,o),l(),p(22,r.dataVenda?22:-1),l(2),p(24,r.status==="ATIVA"?24:-1)}}function Ot(i,d){if(i&1&&(n(0,"div",62)(1,"table",63)(2,"thead",64)(3,"tr")(4,"th",65),a(5,"Ativo"),e(),n(6,"th",65),a(7,"Tipo"),e(),n(8,"th",65),a(9,"Valor Aplicado"),e(),n(10,"th",65),a(11,"Quantidade"),e(),n(12,"th",65),a(13,"Rentabilidade"),e(),n(14,"th",65),a(15,"Status"),e(),n(16,"th",66),a(17,"A\xE7\xF5es"),e()()(),n(18,"tbody",67),I(19,kt,27,12,"tr",68,Ct),e()()()),i&2){let t=s(3);l(19),V(t.aplicacoes())}}function Lt(i,d){if(i&1){let t=T();n(0,"div",20)(1,"a",21),a(2,"Carteiras"),e(),n(3,"span",22),a(4,"\u203A"),e(),n(5,"span",23),a(6),e()(),n(7,"div",24)(8,"div",25)(9,"div",26)(10,"div",27)(11,"h2",28),a(12),e(),_(13,Et,2,0)(14,St,2,0),e(),_(15,Dt,2,1,"p",29)(16,Tt,5,4,"div",30)(17,Ft,9,0),n(18,"div",31)(19,"div")(20,"span",12),a(21,"Criada em:"),e(),a(22),e(),n(23,"div")(24,"span",12),a(25,"\xDAltima atualiza\xE7\xE3o:"),e(),a(26),e()()(),n(27,"button",32),a(28," \u2190 Voltar "),e()()(),n(29,"div",33)(30,"div",34)(31,"p",35),a(32,"Total Aplicado"),e(),n(33,"p",36),a(34),e()(),n(35,"div",37)(36,"p",35),a(37,"Valor Atual"),e(),n(38,"p",38),a(39),e()(),n(40,"div",39)(41,"p",35),a(42,"Rentabilidade"),e(),n(43,"p"),a(44),e(),n(45,"p",40),a(46),e()(),n(47,"div",41)(48,"p",35),a(49,"Aplica\xE7\xF5es"),e(),n(50,"div",42)(51,"p",36),a(52),e(),n(53,"p",43),a(54),e()()()(),n(55,"div",44)(56,"div",45)(57,"h3",36),a(58,"Aplica\xE7\xF5es"),e(),n(59,"button",46),C("click",function(){g(t);let r=s(2);return h(r.abrirModalAplicacao())}),n(60,"span",47),a(61,"\u2795"),e(),a(62," Nova Aplica\xE7\xE3o "),e()(),n(63,"div",48),_(64,yt,9,0,"div",49)(65,Ot,21,0),e()()}if(i&2){let t,o,r,c=d,u=s(2);l(6),v(c.nome),l(6),v(c.nome),l(),p(13,(t=u.tipoOptions)?13:-1,t),l(),p(14,(o=u.riscoOptions)?14:-1,o),l(),p(15,c.descricao?15:-1),l(),p(16,(r=u.investidor())?16:c.tipo==="MODELO"?17:-1,r),l(6),b(" ",u.formatarData(c.createdAt)," "),l(4),b(" ",u.formatarData(c.updatedAt)," "),l(8),v(u.formatarValor(u.totalAplicado)),l(5),v(u.formatarValor(u.totalAtual)),l(4),w(u.rentabilidadeGeral>=0?"text-2xl font-bold text-green-600":"text-2xl font-bold text-red-600"),l(),b(" ",u.formatarPercentual(u.rentabilidadeGeral)," "),l(2),b("Meta: ",u.formatarPercentual(c.metaRentabilidade),""),l(6),v(u.aplicacoes().length),l(2),F(" (",u.aplicacoesAtivas," ativas, ",u.aplicacoesEncerradas," encerradas) "),l(10),p(64,u.aplicacoes().length===0?64:65)}}function Rt(i,d){if(i&1&&_(0,Lt,66,18),i&2){let t,o=s();p(0,(t=o.carteira())?0:-1,t)}}function Nt(i,d){i&1&&(n(0,"div",80)(1,"div",104)(2,"span",105),a(3,"\u2139\uFE0F"),e(),n(4,"p",57)(5,"strong"),a(6,"Carteira Modelo:"),e(),a(7," Os valores e quantidades s\xE3o apenas refer\xEAncias para o template. "),e()()())}function Pt(i,d){if(i&1&&(n(0,"option",86),a(1),e()),i&2){let t=d.$implicit;D("value",t.value),l(),F("",t.icon," ",t.label,"")}}function $t(i,d){i&1&&(n(0,"p",87),a(1,"Tipo \xE9 obrigat\xF3rio"),e())}function qt(i,d){i&1&&a(0," C\xF3digo \xE9 obrigat\xF3rio ")}function Bt(i,d){i&1&&a(0," M\xEDnimo 2 caracteres ")}function jt(i,d){i&1&&a(0," M\xE1ximo 20 caracteres ")}function Gt(i,d){i&1&&a(0," Formato inv\xE1lido para o tipo de produto selecionado ")}function zt(i,d){if(i&1&&(n(0,"p",87),_(1,qt,1,0)(2,Bt,1,0)(3,jt,1,0)(4,Gt,1,0),e()),i&2){let t,o=s(2);l(),p(1,!((t=o.aplicacaoForm.get("codigoAtivo"))==null||t.errors==null)&&t.errors.required?1:!((t=o.aplicacaoForm.get("codigoAtivo"))==null||t.errors==null)&&t.errors.minlength?2:!((t=o.aplicacaoForm.get("codigoAtivo"))==null||t.errors==null)&&t.errors.maxlength?3:!((t=o.aplicacaoForm.get("codigoAtivo"))==null||t.errors==null)&&t.errors.pattern?4:-1)}}function Ut(i,d){i&1&&a(0," \u274C Valor m\xEDnimo: R$ 1,00 ")}function Qt(i,d){i&1&&a(0," \u274C Valor m\xE1ximo: R$ 100.000.000,00 ")}function Zt(i,d){if(i&1&&(n(0,"p",87),_(1,Ut,1,0)(2,Qt,1,0),e()),i&2){let t,o=s(2);l(),p(1,!((t=o.aplicacaoForm.get("valorAplicado"))==null||t.errors==null)&&t.errors.min?1:!((t=o.aplicacaoForm.get("valorAplicado"))==null||t.errors==null)&&t.errors.max?2:-1)}}function Ht(i,d){i&1&&(n(0,"p",87),a(1,"Quantidade deve ser maior que zero"),e())}function Yt(i,d){i&1&&a(0," Data \xE9 obrigat\xF3ria ")}function Jt(i,d){i&1&&a(0," \u274C Data n\xE3o pode ser no futuro ")}function Kt(i,d){i&1&&a(0," \u274C Data n\xE3o pode ser anterior a 10 anos ")}function Wt(i,d){if(i&1&&(n(0,"p",87),_(1,Yt,1,0)(2,Jt,1,0)(3,Kt,1,0),e()),i&2){let t,o=s(2);l(),p(1,!((t=o.aplicacaoForm.get("dataCompra"))==null||t.errors==null)&&t.errors.required?1:!((t=o.aplicacaoForm.get("dataCompra"))==null||t.errors==null)&&t.errors.dataFutura?2:!((t=o.aplicacaoForm.get("dataCompra"))==null||t.errors==null)&&t.errors.dataMuitoAntiga?3:-1)}}function Xt(i,d){i&1&&a(0," Rentabilidade muito baixa (m\xEDnimo -50%) ")}function te(i,d){i&1&&a(0," Rentabilidade muito alta para este tipo de produto ")}function ee(i,d){if(i&1&&(n(0,"p",87),_(1,Xt,1,0)(2,te,1,0),e()),i&2){let t,o=s(2);l(),p(1,!((t=o.aplicacaoForm.get("rentabilidadeAtual"))==null||t.errors==null)&&t.errors.min?1:!((t=o.aplicacaoForm.get("rentabilidadeAtual"))==null||t.errors==null)&&t.errors.max?2:-1)}}function ie(i,d){if(i&1){let t=T();n(0,"div",16)(1,"div",77)(2,"div",45)(3,"h3",78),a(4),e(),n(5,"button",79),C("click",function(){g(t);let r=s();return h(r.fecharModalAplicacao())}),a(6,"\u2715"),e()(),_(7,Nt,8,0,"div",80),n(8,"form",81),C("ngSubmit",function(){g(t);let r=s();return h(r.salvarAplicacao())}),n(9,"div",82)(10,"div")(11,"label",83),a(12,"Tipo de Produto *"),e(),n(13,"select",84)(14,"option",85),a(15,"Selecione o tipo"),e(),I(16,Pt,2,3,"option",86,O),e(),_(18,$t,2,0,"p",87),e(),n(19,"div")(20,"label",88),a(21,"C\xF3digo do Ativo *"),e(),E(22,"input",89),_(23,zt,5,1,"p",87),n(24,"p",40)(25,"strong"),a(26,"Formatos:"),e(),a(27," PETR4 (a\xE7\xF5es), HGLG11 (FII), CDB001 (CDB), TESOURO01 (Tesouro) "),e()(),n(28,"div")(29,"label",90),a(30,"Valor Aplicado *"),e(),E(31,"input",91),_(32,Zt,3,1,"p",87),n(33,"p",40)(34,"strong"),a(35,"Limite:"),e(),a(36," Entre R$ 1,00 e R$ 100.000.000,00 "),e()(),n(37,"div")(38,"label",92),a(39,"Quantidade *"),e(),E(40,"input",93),_(41,Ht,2,0,"p",87),e(),n(42,"div")(43,"label",94),a(44,"Data da Compra *"),e(),E(45,"input",95),_(46,Wt,4,1,"p",87),e(),n(47,"div")(48,"label",96),a(49,"Rentabilidade Atual (%)"),e(),E(50,"input",97),_(51,ee,3,1,"p",87),n(52,"p",40)(53,"strong"),a(54,"Limites:"),e(),a(55," A\xE7\xF5es: at\xE9 200%, FII: at\xE9 50%, CDB/LCI: at\xE9 25%, Tesouro: at\xE9 15% "),e()(),n(56,"div",98)(57,"label",99),a(58,"Notas (Opcional)"),e(),E(59,"textarea",100),e()(),n(60,"div",101)(61,"button",102),C("click",function(){g(t);let r=s();return h(r.fecharModalAplicacao())}),a(62," Cancelar "),e(),n(63,"button",103),a(64),e()()()()()}if(i&2){let t,o,r,c,u,S,y,x=s();l(4),b(" ",x.isEditingAplicacao()?"Editar Aplica\xE7\xE3o":"Nova Aplica\xE7\xE3o"," "),l(3),p(7,((t=x.carteira())==null?null:t.tipo)==="MODELO"&&!((t=x.carteira())!=null&&t.investidorId)?7:-1),l(),D("formGroup",x.aplicacaoForm),l(8),V(x.tipoProdutoOptions),l(2),p(18,(o=x.aplicacaoForm.get("tipoProduto"))!=null&&o.invalid&&((o=x.aplicacaoForm.get("tipoProduto"))!=null&&o.touched)?18:-1),l(5),p(23,(r=x.aplicacaoForm.get("codigoAtivo"))!=null&&r.invalid&&((r=x.aplicacaoForm.get("codigoAtivo"))!=null&&r.touched)?23:-1),l(9),p(32,(c=x.aplicacaoForm.get("valorAplicado"))!=null&&c.invalid&&((c=x.aplicacaoForm.get("valorAplicado"))!=null&&c.touched)?32:-1),l(9),p(41,(u=x.aplicacaoForm.get("quantidade"))!=null&&u.invalid&&((u=x.aplicacaoForm.get("quantidade"))!=null&&u.touched)?41:-1),l(5),p(46,(S=x.aplicacaoForm.get("dataCompra"))!=null&&S.invalid&&((S=x.aplicacaoForm.get("dataCompra"))!=null&&S.touched)?46:-1),l(5),p(51,(y=x.aplicacaoForm.get("rentabilidadeAtual"))!=null&&y.invalid&&((y=x.aplicacaoForm.get("rentabilidadeAtual"))!=null&&y.touched)?51:-1),l(12),D("disabled",x.loading()||x.aplicacaoForm.invalid),l(),b(" ",x.isEditingAplicacao()?"Salvar Altera\xE7\xF5es":"Criar Aplica\xE7\xE3o"," ")}}function ae(i,d){if(i&1){let t=T();n(0,"div",107)(1,"p",108)(2,"span",12),a(3,"Ativo:"),e(),a(4),e(),n(5,"p",109)(6,"span",12),a(7,"Valor Aplicado:"),e(),a(8),e()(),n(9,"form",81),C("ngSubmit",function(){g(t);let r=s(2);return h(r.confirmarEncerrar())}),n(10,"div",110)(11,"label",111),a(12,"Data da Venda *"),e(),E(13,"input",112),e(),n(14,"div",44)(15,"label",113),a(16,"Rentabilidade Final (%) *"),e(),E(17,"input",114),n(18,"p",40),a(19,"Rentabilidade final calculada na venda"),e()(),n(20,"div",115)(21,"button",102),C("click",function(){g(t);let r=s(2);return h(r.cancelarEncerrar())}),a(22," Cancelar "),e(),n(23,"button",116),a(24," Encerrar Aplica\xE7\xE3o "),e()()()}if(i&2){let t=d,o=s(2);l(4),b(" ",t.codigoAtivo," "),l(4),b(" ",o.formatarValor(t.valorAplicado)," "),l(),D("formGroup",o.encerrarForm)}}function ne(i,d){if(i&1){let t=T();n(0,"div",16)(1,"div",106)(2,"div",45)(3,"h3",78),a(4,"\u{1F512} Encerrar Aplica\xE7\xE3o"),e(),n(5,"button",79),C("click",function(){g(t);let r=s();return h(r.cancelarEncerrar())}),a(6,"\u2715"),e()(),_(7,ae,25,3),e()()}if(i&2){let t,o=s();l(7),p(7,(t=o.aplicacaoToEncerrar())?7:-1,t)}}var Se=(()=>{class i{constructor(t,o,r,c,u,S,y,x){this.route=t,this.router=o,this.portfolioService=r,this.aplicacaoService=c,this.investidorService=u,this.toastService=S,this.authService=y,this.fb=x,this.carteira=f(null),this.aplicacoes=f([]),this.investidor=f(null),this.loading=f(!1),this.showAplicacaoModal=f(!1),this.showEncerrarModal=f(!1),this.showDeleteModal=f(!1),this.showLogoutModal=f(!1),this.isEditingAplicacao=f(!1),this.currentAplicacaoId=f(null),this.aplicacaoToDelete=f(null),this.aplicacaoToEncerrar=f(null),this.userName=f(""),this.carteiraId="",this.tipoProdutoOptions=_t,this.riscoOptions=ut,this.tipoOptions=pt,this.statusOptions=xt,this.aplicacaoForm=this.fb.group({tipoProduto:["",[m.required]],codigoAtivo:["",[m.required,m.minLength(2),m.maxLength(20)]],valorAplicado:[0,[m.required,m.min(1)]],quantidade:[0,[m.required,m.min(.01)]],dataCompra:["",[m.required,this.validarDataCompra.bind(this)]],rentabilidadeAtual:[0,[m.min(-50),m.max(200)]],notas:["",[m.maxLength(500)]]}),this.aplicacaoForm.get("tipoProduto")?.valueChanges.subscribe(L=>{this.atualizarValidacaoCodigoAtivo(L),this.atualizarValidacaoRentabilidade(L)}),this.encerrarForm=this.fb.group({dataVenda:["",[m.required]],rentabilidadeFinal:[0,[m.required]]})}ngOnInit(){let t=this.authService.currentUser();t&&this.userName.set(t.nome),this.carteiraId=this.route.snapshot.paramMap.get("id"),this.carteiraId&&(this.carregarCarteira(),this.carregarAplicacoes())}carregarCarteira(){this.loading.set(!0),this.portfolioService.buscarPorId(this.carteiraId).subscribe({next:t=>{this.carteira.set(t.data),t.data.investidorId&&this.carregarInvestidor(t.data.investidorId),this.loading.set(!1)},error:t=>{this.loading.set(!1),this.toastService.error(t.error?.mensagem||"Erro ao carregar carteira"),this.router.navigate(["/carteiras"])}})}carregarInvestidor(t){this.investidorService.buscarPorId(t).subscribe({next:o=>{this.investidor.set(o.data)},error:()=>{}})}carregarAplicacoes(){this.aplicacaoService.listarAplicacoes(this.carteiraId).subscribe({next:t=>{this.aplicacoes.set(t.data)},error:t=>{this.toastService.error(t.error?.mensagem||"Erro ao carregar aplica\xE7\xF5es")}})}abrirModalAplicacao(t){t?(this.isEditingAplicacao.set(!0),this.currentAplicacaoId.set(t.id),this.aplicacaoForm.patchValue(k(M({},t),{dataCompra:this.formatDateForInput(t.dataCompra)}))):(this.isEditingAplicacao.set(!1),this.currentAplicacaoId.set(null),this.aplicacaoForm.reset({valorAplicado:0,quantidade:0,rentabilidadeAtual:0,dataCompra:this.formatDateForInput(new Date().toISOString())})),this.showAplicacaoModal.set(!0)}fecharModalAplicacao(){this.showAplicacaoModal.set(!1),this.aplicacaoForm.reset()}salvarAplicacao(){if(this.aplicacaoForm.invalid){this.toastService.warning("Preencha todos os campos obrigat\xF3rios corretamente"),this.aplicacaoForm.markAllAsTouched();return}this.loading.set(!0);let t=this.aplicacaoForm.value,o=t.dataCompra,r=o.includes("T")?o:`${o}T00:00:00`,c=k(M({portfolioId:this.carteiraId},t),{dataCompra:r});(this.isEditingAplicacao()?this.aplicacaoService.atualizarAplicacao(this.currentAplicacaoId(),c):this.aplicacaoService.criarAplicacao(c)).subscribe({next:()=>{this.loading.set(!1),this.toastService.success(this.isEditingAplicacao()?"Aplica\xE7\xE3o atualizada!":"Aplica\xE7\xE3o criada!"),this.fecharModalAplicacao(),this.carregarAplicacoes(),this.carregarCarteira()},error:S=>{this.loading.set(!1),this.toastService.error(S.error?.mensagem||"Erro ao salvar aplica\xE7\xE3o")}})}abrirModalEncerrar(t){this.aplicacaoToEncerrar.set(t),this.encerrarForm.patchValue({dataVenda:this.formatDateForInput(new Date().toISOString()),rentabilidadeFinal:t.rentabilidadeAtual||0}),this.showEncerrarModal.set(!0)}confirmarEncerrar(){if(this.encerrarForm.invalid){this.toastService.warning("Preencha todos os campos");return}let t=this.aplicacaoToEncerrar();if(!t)return;this.loading.set(!0),this.showEncerrarModal.set(!1);let{dataVenda:o,rentabilidadeFinal:r}=this.encerrarForm.value,c=o.includes("T")?o:`${o}T00:00:00`;this.aplicacaoService.encerrarAplicacao(t.id,c,r).subscribe({next:()=>{this.loading.set(!1),this.toastService.success("Aplica\xE7\xE3o encerrada com sucesso!"),this.aplicacaoToEncerrar.set(null),this.carregarAplicacoes(),this.carregarCarteira()},error:u=>{this.loading.set(!1),this.toastService.error(u.error?.mensagem||"Erro ao encerrar aplica\xE7\xE3o")}})}cancelarEncerrar(){this.showEncerrarModal.set(!1),this.aplicacaoToEncerrar.set(null)}abrirModalExclusao(t){this.aplicacaoToDelete.set(t),this.showDeleteModal.set(!0)}confirmarExclusao(){let t=this.aplicacaoToDelete();t&&(this.loading.set(!0),this.showDeleteModal.set(!1),this.aplicacaoService.deletarAplicacao(t.id).subscribe({next:()=>{this.loading.set(!1),this.toastService.success("Aplica\xE7\xE3o exclu\xEDda!"),this.aplicacaoToDelete.set(null),this.carregarAplicacoes(),this.carregarCarteira()},error:o=>{this.loading.set(!1),this.toastService.error(o.error?.mensagem||"Erro ao excluir aplica\xE7\xE3o")}}))}cancelarExclusao(){this.showDeleteModal.set(!1),this.aplicacaoToDelete.set(null)}abrirModalLogout(){this.showLogoutModal.set(!0)}confirmarLogout(){this.showLogoutModal.set(!1),this.authService.logout()}cancelarLogout(){this.showLogoutModal.set(!1)}getTipoProdutoInfo(t){return this.tipoProdutoOptions.find(o=>o.value===t)}getStatusInfo(t){return this.statusOptions.find(o=>o.value===t)}formatarValor(t){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)}formatarPercentual(t){return`${t>=0?"+":""}${t.toFixed(2)}%`}formatarData(t){return new Date(t).toLocaleDateString("pt-BR")}formatDateForInput(t){return t.split("T")[0]}calcularLucro(t){return t.valorAplicado*(t.rentabilidadeAtual/100)}calcularValorAtual(t){return t.valorAplicado+this.calcularLucro(t)}get totalAplicado(){return this.aplicacoes().reduce((t,o)=>t+o.valorAplicado,0)}get totalAtual(){return this.aplicacoes().reduce((t,o)=>t+this.calcularValorAtual(o),0)}get rentabilidadeGeral(){return this.totalAplicado===0?0:(this.totalAtual-this.totalAplicado)/this.totalAplicado*100}get aplicacoesAtivas(){return this.aplicacoes().filter(t=>t.status==="ATIVA").length}get aplicacoesEncerradas(){return this.aplicacoes().filter(t=>t.status==="ENCERRADA").length}atualizarValidacaoCodigoAtivo(t){let o=this.aplicacaoForm.get("codigoAtivo");if(o){switch(o.clearValidators(),o.setValidators([m.required,m.minLength(2),m.maxLength(20)]),t){case"ACAO":o.addValidators(m.pattern(/^[A-Z]{4}\d{1,2}$/));break;case"FII":o.addValidators(m.pattern(/^[A-Z]{4}11$/));break;case"CDB":o.addValidators(m.pattern(/^CDB\d{3,6}$/));break;case"LCI":o.addValidators(m.pattern(/^LCI\d{3,6}$/));break;case"LCA":o.addValidators(m.pattern(/^LCA\d{3,6}$/));break;case"TESOURO_DIRETO":o.addValidators(m.pattern(/^(TESOURO|TS)\d{2,4}$/));break;case"FUNDO_INVESTIMENTO":o.addValidators(m.pattern(/^[A-Z]{2,6}\d{2,4}$/));break}o.updateValueAndValidity()}}atualizarValidacaoRentabilidade(t){let o=this.aplicacaoForm.get("rentabilidadeAtual");if(o){switch(o.clearValidators(),o.setValidators([m.min(-50)]),t){case"ACAO":o.addValidators(m.max(200));break;case"FII":o.addValidators(m.max(50));break;case"CDB":case"LCI":case"LCA":o.addValidators(m.max(25));break;case"TESOURO_DIRETO":o.addValidators(m.max(15));break;case"FUNDO_INVESTIMENTO":o.addValidators(m.max(100));break}o.updateValueAndValidity()}}validarDataCompra(t){if(!t.value)return null;let o=new Date(t.value),r=new Date,c=new Date;return c.setFullYear(r.getFullYear()-10),o>r?{dataFutura:!0}:o<c?{dataMuitoAntiga:!0}:null}static{this.\u0275fac=function(o){return new(o||i)(A(q),A(B),A(ct),A(st),A(dt),A(G),A(ot),A(at))}}static{this.\u0275cmp=R({type:i,selectors:[["app-carteira-detail"]],standalone:!0,features:[N],decls:28,vars:18,consts:[[1,"min-h-screen","bg-gray-50","dark:bg-slate-950","flex","flex-col"],[1,"bg-white","dark:bg-slate-900","shadow-sm","border-b","border-gray-200","dark:border-slate-700"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"flex","justify-between","items-center","h-20"],[1,"flex","items-center"],["src","assets/logo.png","alt","BartoFinance","routerLink","/dashboard",1,"h-16","w-auto","hover:opacity-80","transition-opacity","cursor-pointer"],[1,"hidden","md:flex","items-center","space-x-8"],["routerLink","/dashboard",1,"text-gray-600","hover:text-primary-600","transition"],["routerLink","/investidores",1,"text-gray-600","hover:text-primary-600","transition"],["routerLink","/carteiras",1,"text-gray-900","hover:text-primary-600","font-medium","transition"],[1,"flex","items-center","space-x-4"],[1,"text-sm","text-gray-700"],[1,"font-semibold"],[1,"btn-ghost","text-sm",3,"click"],[1,"flex-1","max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8","w-full"],[1,"flex","justify-center","items-center","py-12"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-75","flex","items-center","justify-center","z-50","animate-fade-in"],[3,"confirm","cancel","show","title","message","confirmText","cancelText","type","icon"],[1,"animate-spin","rounded-full","h-12","w-12","border-4","border-primary-500","border-t-transparent"],[1,"ml-4","text-primary-600"],[1,"mb-6","flex","items-center","text-sm","text-gray-600","animate-fade-in"],["routerLink","/carteiras",1,"hover:text-primary-600"],[1,"mx-2"],[1,"text-gray-900","font-medium"],[1,"card","mb-6","animate-slide-up"],[1,"flex","justify-between","items-start"],[1,"flex-1"],[1,"flex","items-center","gap-3","mb-3"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-gray-600","mb-4"],[1,"flex","items-center","gap-2","text-sm","text-gray-700","mb-2"],[1,"grid","grid-cols-2","gap-4","mt-4","text-sm","text-gray-600"],["routerLink","/carteiras",1,"btn-ghost"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6","mb-8"],[1,"card","animate-slide-up","animation-delay-200"],[1,"text-sm","font-medium","text-gray-600","mb-1"],[1,"text-2xl","font-bold","text-gray-900"],[1,"card","animate-slide-up","animation-delay-300"],[1,"text-2xl","font-bold","text-primary-600"],[1,"card","animate-slide-up","animation-delay-400"],[1,"text-xs","text-gray-500","mt-1"],[1,"card","animate-slide-up","animation-delay-500"],[1,"flex","items-baseline","gap-2"],[1,"text-xs","text-gray-500"],[1,"mb-6"],[1,"flex","justify-between","items-center","mb-4"],[1,"btn-primary","flex","items-center",3,"click"],[1,"mr-2"],[1,"card"],[1,"text-center","py-8","text-gray-500"],[1,"badge","bg-purple-100","text-purple-800"],[3,"class"],[1,"text-primary-600","hover:text-primary-800","font-medium",3,"routerLink"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","mb-4"],[1,"flex","items-start","gap-3"],[1,"text-2xl"],[1,"font-semibold","text-blue-900","mb-1"],[1,"text-sm","text-blue-800"],[1,"text-4xl","mb-4"],[1,"text-lg","font-medium"],[1,"text-sm","mt-2"],[1,"btn-primary","mt-6",3,"click"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase"],["scope","col",1,"px-6","py-3","text-right","text-xs","font-medium","text-gray-500","uppercase"],[1,"bg-white","divide-y","divide-gray-200"],[1,"hover:bg-gray-50","transition-colors"],[1,"px-6","py-4","whitespace-nowrap"],[1,"text-sm","font-medium","text-gray-900"],[1,"badge","bg-gray-100","text-gray-800"],[1,"text-sm","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap","text-right","text-sm","font-medium"],["title","Excluir",1,"text-red-600","hover:text-red-900",3,"click"],["title","Editar",1,"text-primary-600","hover:text-primary-900","mr-3",3,"click"],["title","Encerrar",1,"text-yellow-600","hover:text-yellow-900","mr-3",3,"click"],[1,"bg-white","rounded-lg","shadow-xl","p-6","w-full","max-w-2xl","max-h-[90vh]","overflow-y-auto","animate-slide-up"],[1,"text-xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600",3,"click"],[1,"bg-blue-50","border-l-4","border-blue-500","p-3","mb-4"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],["for","tipoProduto",1,"label"],["id","tipoProduto","formControlName","tipoProduto",1,"input"],["value","","disabled",""],[3,"value"],[1,"text-red-600","text-sm","mt-1"],["for","codigoAtivo",1,"label"],["id","codigoAtivo","type","text","formControlName","codigoAtivo","placeholder","Ex: PETR4 (a\xE7\xF5es), HGLG11 (FII), CDB001 (CDB)","maxlength","20",1,"input"],["for","valorAplicado",1,"label"],["id","valorAplicado","type","text","formControlName","valorAplicado","placeholder","R$ 0,00","appCurrencyMask","",1,"input"],["for","quantidade",1,"label"],["id","quantidade","type","number","formControlName","quantidade","placeholder","0","step","0.01","min","0.01",1,"input"],["for","dataCompra",1,"label"],["id","dataCompra","type","date","formControlName","dataCompra",1,"input"],["for","rentabilidadeAtual",1,"label"],["id","rentabilidadeAtual","type","number","formControlName","rentabilidadeAtual","placeholder","0.00","step","0.01","min","-50","max","200",1,"input"],[1,"md:col-span-2"],["for","notas",1,"label"],["id","notas","formControlName","notas","rows","2","placeholder","Observa\xE7\xF5es sobre esta aplica\xE7\xE3o...",1,"input"],[1,"flex","justify-end","space-x-4","mt-6"],["type","button",1,"btn-secondary",3,"click"],["type","submit",1,"btn-primary",3,"disabled"],[1,"flex","items-center","gap-2"],[1,"text-blue-600"],[1,"bg-white","rounded-lg","shadow-xl","p-6","w-full","max-w-md","animate-slide-up"],[1,"mb-4","p-4","bg-yellow-50","border","border-yellow-200","rounded-lg"],[1,"text-sm","text-yellow-800","mb-2"],[1,"text-sm","text-yellow-800"],[1,"mb-4"],["for","dataVenda",1,"label"],["id","dataVenda","type","date","formControlName","dataVenda",1,"input"],["for","rentabilidadeFinal",1,"label"],["id","rentabilidadeFinal","type","number","formControlName","rentabilidadeFinal","placeholder","0.00","step","0.01",1,"input"],[1,"flex","justify-end","space-x-4"],["type","submit",1,"bg-yellow-600","text-white","px-4","py-2","rounded-lg","hover:bg-yellow-700","transition"]],template:function(o,r){if(o&1&&(n(0,"div",0)(1,"nav",1)(2,"div",2)(3,"div",3)(4,"div",4),E(5,"img",5),e(),n(6,"div",6)(7,"a",7),a(8,"Dashboard"),e(),n(9,"a",8),a(10,"Investidores"),e(),n(11,"a",9),a(12,"Carteiras"),e()(),n(13,"div",10)(14,"span",11),a(15,"Ol\xE1, "),n(16,"span",12),a(17),e()(),n(18,"button",13),C("click",function(){return r.abrirModalLogout()}),a(19,"Sair"),e()()()()(),n(20,"main",14),_(21,vt,4,0,"div",15)(22,Rt,1,1),e(),_(23,ie,65,11,"div",16)(24,ne,8,1,"div",16),E(25,"app-footer"),n(26,"app-confirm-modal",17),C("confirm",function(){return r.confirmarExclusao()})("cancel",function(){return r.cancelarExclusao()}),e(),n(27,"app-confirm-modal",17),C("confirm",function(){return r.confirmarLogout()})("cancel",function(){return r.cancelarLogout()}),e()()),o&2){let c;l(17),v(r.userName()),l(4),p(21,r.loading()&&!r.carteira()?21:r.carteira()?22:-1),l(2),p(23,r.showAplicacaoModal()?23:-1),l(),p(24,r.showEncerrarModal()?24:-1),l(2),D("show",r.showDeleteModal())("title","Excluir Aplica\xE7\xE3o")("message","Tem certeza que deseja excluir a aplica\xE7\xE3o "+(((c=r.aplicacaoToDelete())==null?null:c.codigoAtivo)||"")+"? Esta a\xE7\xE3o n\xE3o pode ser desfeita.")("confirmText","Excluir")("cancelText","Cancelar")("type","danger")("icon","\u{1F5D1}\uFE0F"),l(),D("show",r.showLogoutModal())("title","Sair do Sistema")("message","Voc\xEA deseja realmente sair do sistema? Voc\xEA precisar\xE1 fazer login novamente para acessar.")("confirmText","Sair")("cancelText","Cancelar")("type","warning")("icon","\u{1F44B}")}},dependencies:[$,j,rt,nt,Z,W,X,z,H,K,U,Q,it,et,tt,Y,J,lt,mt]})}}return i})();export{Se as CarteiraDetailComponent};
