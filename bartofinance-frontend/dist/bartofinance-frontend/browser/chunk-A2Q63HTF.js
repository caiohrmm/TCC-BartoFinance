import{a as st}from"./chunk-KKE4LPTK.js";import{a as mt}from"./chunk-P2FGC6GW.js";import{b as z,c as s,d as U,e as Q,g as Z,h as H,i as J,j as K,k as W,l as X,m as Y,n as tt,o as et,p as it,q as at,s as nt}from"./chunk-S2EJ55TC.js";import{a as pt,b as ut}from"./chunk-JRTYZLGQ.js";import{a as dt}from"./chunk-MELCVFHK.js";import{a as G}from"./chunk-SEIL6NAD.js";import{a as rt,b as lt,c as ct}from"./chunk-PCOA7WY5.js";import{D as l,E as A,Ea as q,Ga as B,Ha as j,K as f,Ka as ot,M as x,O as D,Q as I,R as u,T as w,U as V,V as i,W as e,X as E,Y as T,Z as C,_ as m,a as M,b as O,ca as a,da as v,ea as b,fa as y,la as N,ma as P,r as R,v as h,w as g,xa as $}from"./chunk-FEKYFKK3.js";var _t=[{value:"CDB",label:"CDB",icon:"\u{1F3E6}",description:"Certificado de Dep\xF3sito Banc\xE1rio"},{value:"TESOURO_DIRETO",label:"Tesouro Direto",icon:"\u{1F3DB}\uFE0F",description:"Tesouro Direto"},{value:"ACOES",label:"A\xE7\xF5es",icon:"\u{1F4C8}",description:"A\xE7\xF5es"},{value:"FUNDOS",label:"Fundos",icon:"\u{1F4BC}",description:"Fundos de Investimento"},{value:"CRIPTOMOEDAS",label:"Criptomoedas",icon:"\u20BF",description:"Criptomoedas"},{value:"OUTROS",label:"Outros",icon:"\u{1F4CA}",description:"Outros"}],xt=[{value:"ATIVA",label:"Ativa",color:"green",icon:"\u2713",description:"Aplica\xE7\xE3o Ativa"},{value:"RESGATADA",label:"Resgatada",color:"blue",icon:"\u{1F4B0}",description:"Aplica\xE7\xE3o Resgatada"},{value:"ENCERRADA",label:"Encerrada",color:"gray",icon:"\u25A0",description:"Aplica\xE7\xE3o Encerrada"}];var k=(n,c)=>c.value,Ct=(n,c)=>c.id,ft=n=>["/investidores",n];function vt(n,c){n&1&&(i(0,"div",15),E(1,"span",18),i(2,"p",19),a(3,"Carregando detalhes..."),e()())}function ht(n,c){if(n&1&&(i(0,"span",50),a(1),e()),n&2){let t=m().$implicit;l(),y(" ",t.icon," ",t.label," ")}}function gt(n,c){if(n&1&&x(0,ht,2,2,"span",50),n&2){let t=c.$implicit,o=m(2);u(0,o.tipo===t.value?0:-1)}}function Et(n,c){n&1&&w(0,gt,1,1,null,null,k),n&2&&V(c)}function bt(n,c){if(n&1&&(i(0,"span"),a(1),e()),n&2){let t=m().$implicit;I("badge bg-"+t.color+"-100 text-"+t.color+"-800"),l(),y(" ",t.icon," ",t.label," ")}}function At(n,c){if(n&1&&x(0,bt,2,4,"span",51),n&2){let t=c.$implicit,o=m(2);u(0,o.risco===t.value?0:-1)}}function St(n,c){n&1&&w(0,At,1,1,null,null,k),n&2&&V(c)}function Dt(n,c){if(n&1&&(i(0,"p",29),a(1),e()),n&2){let t=m();l(),v(t.descricao)}}function Tt(n,c){if(n&1&&(i(0,"div",30)(1,"span",12),a(2,"Investidor:"),e(),i(3,"a",52),a(4),e()()),n&2){let t=c;l(3),D("routerLink",P(2,ft,t.id)),l(),b(" ",t.nome," ")}}function yt(n,c){n&1&&(i(0,"div",53)(1,"div",54)(2,"span",55),a(3,"\u{1F4CB}"),e(),i(4,"div")(5,"h4",56),a(6,"Carteira Modelo"),e(),i(7,"p",57),a(8," Esta \xE9 uma carteira modelo (template) sem investidor vinculado. As aplica\xE7\xF5es cadastradas aqui servem como refer\xEAncia. Ao vincular um investidor, voc\xEA poder\xE1 definir os valores reais dos investimentos. "),e()()()())}function Ft(n,c){if(n&1){let t=T();i(0,"div",49)(1,"p",58),a(2,"\u{1F4CA}"),e(),i(3,"p",59),a(4,"Nenhuma aplica\xE7\xE3o registrada."),e(),i(5,"p",60),a(6,"Comece adicionando uma aplica\xE7\xE3o nesta carteira."),e(),i(7,"button",61),C("click",function(){h(t);let r=m(3);return g(r.abrirModalAplicacao())}),a(8," Adicionar Primeira Aplica\xE7\xE3o "),e()()}}function It(n,c){if(n&1&&(i(0,"span",71),a(1),e()),n&2){let t=c;l(),y(" ",t.icon," ",t.label," ")}}function wt(n,c){if(n&1&&(i(0,"span"),a(1),e()),n&2){let t=c;I("badge bg-"+t.color+"-100 text-"+t.color+"-800"),l(),y(" ",t.icon," ",t.label," ")}}function Vt(n,c){if(n&1&&(i(0,"div",40),a(1),e()),n&2){let t=m().$implicit,o=m(4);l(),v(o.formatarData(t.dataVenda))}}function Mt(n,c){if(n&1){let t=T();i(0,"button",75),C("click",function(){h(t);let r=m().$implicit,d=m(4);return g(d.abrirModalAplicacao(r))}),a(1," \u270F\uFE0F "),e(),i(2,"button",76),C("click",function(){h(t);let r=m().$implicit,d=m(4);return g(d.abrirModalEncerrar(r))}),a(3," \u{1F512} "),e()}}function Ot(n,c){if(n&1){let t=T();i(0,"tr",68)(1,"td",69)(2,"div")(3,"div",70),a(4),e(),i(5,"div",43),a(6),e()()(),i(7,"td",69),x(8,It,2,2,"span",71),e(),i(9,"td",69)(10,"div",72),a(11),e()(),i(12,"td",69)(13,"div",72),a(14),e()(),i(15,"td",69)(16,"div"),a(17),e(),i(18,"div",43),a(19),e()(),i(20,"td",69),x(21,wt,2,4,"span",51)(22,Vt,2,1,"div",40),e(),i(23,"td",73),x(24,Mt,4,0),i(25,"button",74),C("click",function(){let r=h(t).$implicit,d=m(4);return g(d.abrirModalExclusao(r))}),a(26," \u{1F5D1}\uFE0F "),e()()()}if(n&2){let t,o,r=c.$implicit,d=m(4);l(4),v(r.codigoAtivo),l(2),v(d.formatarData(r.dataCompra)),l(2),u(8,(t=d.getTipoProdutoInfo(r.tipoProduto))?8:-1,t),l(3),v(d.formatarValor(r.valorAplicado)),l(3),v(r.quantidade),l(2),I(r.rentabilidadeAtual>=0?"text-sm font-medium text-green-600":"text-sm font-medium text-red-600"),l(),b(" ",d.formatarPercentual(r.rentabilidadeAtual)," "),l(2),b(" ",d.formatarValor(d.calcularLucro(r))," "),l(2),u(21,(o=d.getStatusInfo(r.status))?21:-1,o),l(),u(22,r.dataVenda?22:-1),l(2),u(24,r.status==="ATIVA"?24:-1)}}function kt(n,c){if(n&1&&(i(0,"div",62)(1,"table",63)(2,"thead",64)(3,"tr")(4,"th",65),a(5,"Ativo"),e(),i(6,"th",65),a(7,"Tipo"),e(),i(8,"th",65),a(9,"Valor Aplicado"),e(),i(10,"th",65),a(11,"Quantidade"),e(),i(12,"th",65),a(13,"Rentabilidade"),e(),i(14,"th",65),a(15,"Status"),e(),i(16,"th",66),a(17,"A\xE7\xF5es"),e()()(),i(18,"tbody",67),w(19,Ot,27,12,"tr",68,Ct),e()()()),n&2){let t=m(3);l(19),V(t.aplicacoes())}}function Lt(n,c){if(n&1){let t=T();i(0,"div",20)(1,"a",21),a(2,"Carteiras"),e(),i(3,"span",22),a(4,"\u203A"),e(),i(5,"span",23),a(6),e()(),i(7,"div",24)(8,"div",25)(9,"div",26)(10,"div",27)(11,"h2",28),a(12),e(),x(13,Et,2,0)(14,St,2,0),e(),x(15,Dt,2,1,"p",29)(16,Tt,5,4,"div",30)(17,yt,9,0),i(18,"div",31)(19,"div")(20,"span",12),a(21,"Criada em:"),e(),a(22),e(),i(23,"div")(24,"span",12),a(25,"\xDAltima atualiza\xE7\xE3o:"),e(),a(26),e()()(),i(27,"button",32),a(28," \u2190 Voltar "),e()()(),i(29,"div",33)(30,"div",34)(31,"p",35),a(32,"Total Aplicado"),e(),i(33,"p",36),a(34),e()(),i(35,"div",37)(36,"p",35),a(37,"Valor Atual"),e(),i(38,"p",38),a(39),e()(),i(40,"div",39)(41,"p",35),a(42,"Rentabilidade"),e(),i(43,"p"),a(44),e(),i(45,"p",40),a(46),e()(),i(47,"div",41)(48,"p",35),a(49,"Aplica\xE7\xF5es"),e(),i(50,"div",42)(51,"p",36),a(52),e(),i(53,"p",43),a(54),e()()()(),i(55,"div",44)(56,"div",45)(57,"h3",36),a(58,"Aplica\xE7\xF5es"),e(),i(59,"button",46),C("click",function(){h(t);let r=m(2);return g(r.abrirModalAplicacao())}),i(60,"span",47),a(61,"\u2795"),e(),a(62," Nova Aplica\xE7\xE3o "),e()(),i(63,"div",48),x(64,Ft,9,0,"div",49)(65,kt,21,0),e()()}if(n&2){let t,o,r,d=c,p=m(2);l(6),v(d.nome),l(6),v(d.nome),l(),u(13,(t=p.tipoOptions)?13:-1,t),l(),u(14,(o=p.riscoOptions)?14:-1,o),l(),u(15,d.descricao?15:-1),l(),u(16,(r=p.investidor())?16:d.tipo==="MODELO"?17:-1,r),l(6),b(" ",p.formatarData(d.createdAt)," "),l(4),b(" ",p.formatarData(d.updatedAt)," "),l(8),v(p.formatarValor(p.totalAplicado)),l(5),v(p.formatarValor(p.totalAtual)),l(4),I(p.rentabilidadeGeral>=0?"text-2xl font-bold text-green-600":"text-2xl font-bold text-red-600"),l(),b(" ",p.formatarPercentual(p.rentabilidadeGeral)," "),l(2),b("Meta: ",p.formatarPercentual(d.metaRentabilidade),""),l(6),v(p.aplicacoes().length),l(2),y(" (",p.aplicacoesAtivas," ativas, ",p.aplicacoesEncerradas," encerradas) "),l(10),u(64,p.aplicacoes().length===0?64:65)}}function Rt(n,c){if(n&1&&x(0,Lt,66,18),n&2){let t,o=m();u(0,(t=o.carteira())?0:-1,t)}}function Nt(n,c){n&1&&(i(0,"div",80)(1,"div",104)(2,"span",105),a(3,"\u2139\uFE0F"),e(),i(4,"p",57)(5,"strong"),a(6,"Carteira Modelo:"),e(),a(7," Os valores e quantidades s\xE3o apenas refer\xEAncias para o template. "),e()()())}function Pt(n,c){if(n&1&&(i(0,"option",86),a(1),e()),n&2){let t=c.$implicit;D("value",t.value),l(),y("",t.icon," ",t.label,"")}}function $t(n,c){n&1&&(i(0,"p",87),a(1,"Tipo \xE9 obrigat\xF3rio"),e())}function qt(n,c){n&1&&a(0," C\xF3digo \xE9 obrigat\xF3rio ")}function Bt(n,c){n&1&&a(0," M\xEDnimo 2 caracteres ")}function jt(n,c){n&1&&a(0," M\xE1ximo 20 caracteres ")}function Gt(n,c){n&1&&a(0," Formato inv\xE1lido para o tipo de produto selecionado ")}function zt(n,c){if(n&1&&(i(0,"p",87),x(1,qt,1,0)(2,Bt,1,0)(3,jt,1,0)(4,Gt,1,0),e()),n&2){let t,o=m(2);l(),u(1,!((t=o.aplicacaoForm.get("codigoAtivo"))==null||t.errors==null)&&t.errors.required?1:!((t=o.aplicacaoForm.get("codigoAtivo"))==null||t.errors==null)&&t.errors.minlength?2:!((t=o.aplicacaoForm.get("codigoAtivo"))==null||t.errors==null)&&t.errors.maxlength?3:!((t=o.aplicacaoForm.get("codigoAtivo"))==null||t.errors==null)&&t.errors.pattern?4:-1)}}function Ut(n,c){n&1&&(i(0,"p",87),a(1,"Valor deve ser maior que zero"),e())}function Qt(n,c){n&1&&(i(0,"p",87),a(1,"Quantidade deve ser maior que zero"),e())}function Zt(n,c){n&1&&(i(0,"p",87),a(1,"Data \xE9 obrigat\xF3ria"),e())}function Ht(n,c){n&1&&a(0," Rentabilidade muito baixa (m\xEDnimo -50%) ")}function Jt(n,c){n&1&&a(0," Rentabilidade muito alta para este tipo de produto ")}function Kt(n,c){if(n&1&&(i(0,"p",87),x(1,Ht,1,0)(2,Jt,1,0),e()),n&2){let t,o=m(2);l(),u(1,!((t=o.aplicacaoForm.get("rentabilidadeAtual"))==null||t.errors==null)&&t.errors.min?1:!((t=o.aplicacaoForm.get("rentabilidadeAtual"))==null||t.errors==null)&&t.errors.max?2:-1)}}function Wt(n,c){if(n&1){let t=T();i(0,"div",16)(1,"div",77)(2,"div",45)(3,"h3",78),a(4),e(),i(5,"button",79),C("click",function(){h(t);let r=m();return g(r.fecharModalAplicacao())}),a(6,"\u2715"),e()(),x(7,Nt,8,0,"div",80),i(8,"form",81),C("ngSubmit",function(){h(t);let r=m();return g(r.salvarAplicacao())}),i(9,"div",82)(10,"div")(11,"label",83),a(12,"Tipo de Produto *"),e(),i(13,"select",84)(14,"option",85),a(15,"Selecione o tipo"),e(),w(16,Pt,2,3,"option",86,k),e(),x(18,$t,2,0,"p",87),e(),i(19,"div")(20,"label",88),a(21,"C\xF3digo do Ativo *"),e(),E(22,"input",89),x(23,zt,5,1,"p",87),i(24,"p",40)(25,"strong"),a(26,"Formatos:"),e(),a(27," PETR4 (a\xE7\xF5es), HGLG11 (FII), CDB001 (CDB), TESOURO01 (Tesouro) "),e()(),i(28,"div")(29,"label",90),a(30,"Valor Aplicado *"),e(),E(31,"input",91),x(32,Ut,2,0,"p",87),e(),i(33,"div")(34,"label",92),a(35,"Quantidade *"),e(),E(36,"input",93),x(37,Qt,2,0,"p",87),e(),i(38,"div")(39,"label",94),a(40,"Data da Compra *"),e(),E(41,"input",95),x(42,Zt,2,0,"p",87),e(),i(43,"div")(44,"label",96),a(45,"Rentabilidade Atual (%)"),e(),E(46,"input",97),x(47,Kt,3,1,"p",87),i(48,"p",40)(49,"strong"),a(50,"Limites:"),e(),a(51," A\xE7\xF5es: at\xE9 200%, FII: at\xE9 50%, CDB/LCI: at\xE9 25%, Tesouro: at\xE9 15% "),e()(),i(52,"div",98)(53,"label",99),a(54,"Notas (Opcional)"),e(),E(55,"textarea",100),e()(),i(56,"div",101)(57,"button",102),C("click",function(){h(t);let r=m();return g(r.fecharModalAplicacao())}),a(58," Cancelar "),e(),i(59,"button",103),a(60),e()()()()()}if(n&2){let t,o,r,d,p,S,F,_=m();l(4),b(" ",_.isEditingAplicacao()?"Editar Aplica\xE7\xE3o":"Nova Aplica\xE7\xE3o"," "),l(3),u(7,((t=_.carteira())==null?null:t.tipo)==="MODELO"&&!((t=_.carteira())!=null&&t.investidorId)?7:-1),l(),D("formGroup",_.aplicacaoForm),l(8),V(_.tipoProdutoOptions),l(2),u(18,(o=_.aplicacaoForm.get("tipoProduto"))!=null&&o.invalid&&((o=_.aplicacaoForm.get("tipoProduto"))!=null&&o.touched)?18:-1),l(5),u(23,(r=_.aplicacaoForm.get("codigoAtivo"))!=null&&r.invalid&&((r=_.aplicacaoForm.get("codigoAtivo"))!=null&&r.touched)?23:-1),l(9),u(32,(d=_.aplicacaoForm.get("valorAplicado"))!=null&&d.invalid&&((d=_.aplicacaoForm.get("valorAplicado"))!=null&&d.touched)?32:-1),l(5),u(37,(p=_.aplicacaoForm.get("quantidade"))!=null&&p.invalid&&((p=_.aplicacaoForm.get("quantidade"))!=null&&p.touched)?37:-1),l(5),u(42,(S=_.aplicacaoForm.get("dataCompra"))!=null&&S.invalid&&((S=_.aplicacaoForm.get("dataCompra"))!=null&&S.touched)?42:-1),l(5),u(47,(F=_.aplicacaoForm.get("rentabilidadeAtual"))!=null&&F.invalid&&((F=_.aplicacaoForm.get("rentabilidadeAtual"))!=null&&F.touched)?47:-1),l(12),D("disabled",_.loading()||_.aplicacaoForm.invalid),l(),b(" ",_.isEditingAplicacao()?"Salvar Altera\xE7\xF5es":"Criar Aplica\xE7\xE3o"," ")}}function Xt(n,c){if(n&1){let t=T();i(0,"div",107)(1,"p",108)(2,"span",12),a(3,"Ativo:"),e(),a(4),e(),i(5,"p",109)(6,"span",12),a(7,"Valor Aplicado:"),e(),a(8),e()(),i(9,"form",81),C("ngSubmit",function(){h(t);let r=m(2);return g(r.confirmarEncerrar())}),i(10,"div",110)(11,"label",111),a(12,"Data da Venda *"),e(),E(13,"input",112),e(),i(14,"div",44)(15,"label",113),a(16,"Rentabilidade Final (%) *"),e(),E(17,"input",114),i(18,"p",40),a(19,"Rentabilidade final calculada na venda"),e()(),i(20,"div",115)(21,"button",102),C("click",function(){h(t);let r=m(2);return g(r.cancelarEncerrar())}),a(22," Cancelar "),e(),i(23,"button",116),a(24," Encerrar Aplica\xE7\xE3o "),e()()()}if(n&2){let t=c,o=m(2);l(4),b(" ",t.codigoAtivo," "),l(4),b(" ",o.formatarValor(t.valorAplicado)," "),l(),D("formGroup",o.encerrarForm)}}function Yt(n,c){if(n&1){let t=T();i(0,"div",16)(1,"div",106)(2,"div",45)(3,"h3",78),a(4,"\u{1F512} Encerrar Aplica\xE7\xE3o"),e(),i(5,"button",79),C("click",function(){h(t);let r=m();return g(r.cancelarEncerrar())}),a(6,"\u2715"),e()(),x(7,Xt,25,3),e()()}if(n&2){let t,o=m();l(7),u(7,(t=o.aplicacaoToEncerrar())?7:-1,t)}}var he=(()=>{class n{constructor(t,o,r,d,p,S,F,_){this.route=t,this.router=o,this.portfolioService=r,this.aplicacaoService=d,this.investidorService=p,this.toastService=S,this.authService=F,this.fb=_,this.carteira=f(null),this.aplicacoes=f([]),this.investidor=f(null),this.loading=f(!1),this.showAplicacaoModal=f(!1),this.showEncerrarModal=f(!1),this.showDeleteModal=f(!1),this.showLogoutModal=f(!1),this.isEditingAplicacao=f(!1),this.currentAplicacaoId=f(null),this.aplicacaoToDelete=f(null),this.aplicacaoToEncerrar=f(null),this.userName=f(""),this.carteiraId="",this.tipoProdutoOptions=_t,this.riscoOptions=ut,this.tipoOptions=pt,this.statusOptions=xt,this.aplicacaoForm=this.fb.group({tipoProduto:["",[s.required]],codigoAtivo:["",[s.required,s.minLength(2),s.maxLength(20)]],valorAplicado:[0,[s.required,s.min(.01)]],quantidade:[0,[s.required,s.min(.01)]],dataCompra:["",[s.required]],rentabilidadeAtual:[0,[s.min(-50),s.max(200)]],notas:["",[s.maxLength(500)]]}),this.aplicacaoForm.get("tipoProduto")?.valueChanges.subscribe(L=>{this.atualizarValidacaoCodigoAtivo(L),this.atualizarValidacaoRentabilidade(L)}),this.encerrarForm=this.fb.group({dataVenda:["",[s.required]],rentabilidadeFinal:[0,[s.required]]})}ngOnInit(){let t=this.authService.currentUser();t&&this.userName.set(t.nome),this.carteiraId=this.route.snapshot.paramMap.get("id"),this.carteiraId&&(this.carregarCarteira(),this.carregarAplicacoes())}carregarCarteira(){this.loading.set(!0),this.portfolioService.buscarPorId(this.carteiraId).subscribe({next:t=>{this.carteira.set(t.data),t.data.investidorId&&this.carregarInvestidor(t.data.investidorId),this.loading.set(!1)},error:t=>{this.loading.set(!1),this.toastService.error(t.error?.mensagem||"Erro ao carregar carteira"),this.router.navigate(["/carteiras"])}})}carregarInvestidor(t){this.investidorService.buscarPorId(t).subscribe({next:o=>{this.investidor.set(o.data)},error:()=>{}})}carregarAplicacoes(){this.aplicacaoService.listarAplicacoes(this.carteiraId).subscribe({next:t=>{this.aplicacoes.set(t.data)},error:t=>{this.toastService.error(t.error?.mensagem||"Erro ao carregar aplica\xE7\xF5es")}})}abrirModalAplicacao(t){t?(this.isEditingAplicacao.set(!0),this.currentAplicacaoId.set(t.id),this.aplicacaoForm.patchValue(O(M({},t),{dataCompra:this.formatDateForInput(t.dataCompra)}))):(this.isEditingAplicacao.set(!1),this.currentAplicacaoId.set(null),this.aplicacaoForm.reset({valorAplicado:0,quantidade:0,rentabilidadeAtual:0,dataCompra:this.formatDateForInput(new Date().toISOString())})),this.showAplicacaoModal.set(!0)}fecharModalAplicacao(){this.showAplicacaoModal.set(!1),this.aplicacaoForm.reset()}salvarAplicacao(){if(this.aplicacaoForm.invalid){this.toastService.warning("Preencha todos os campos obrigat\xF3rios corretamente"),this.aplicacaoForm.markAllAsTouched();return}this.loading.set(!0);let t=this.aplicacaoForm.value,o=t.dataCompra,r=o.includes("T")?o:`${o}T00:00:00`,d=O(M({portfolioId:this.carteiraId},t),{dataCompra:r});(this.isEditingAplicacao()?this.aplicacaoService.atualizarAplicacao(this.currentAplicacaoId(),d):this.aplicacaoService.criarAplicacao(d)).subscribe({next:()=>{this.loading.set(!1),this.toastService.success(this.isEditingAplicacao()?"Aplica\xE7\xE3o atualizada!":"Aplica\xE7\xE3o criada!"),this.fecharModalAplicacao(),this.carregarAplicacoes(),this.carregarCarteira()},error:S=>{this.loading.set(!1),this.toastService.error(S.error?.mensagem||"Erro ao salvar aplica\xE7\xE3o")}})}abrirModalEncerrar(t){this.aplicacaoToEncerrar.set(t),this.encerrarForm.patchValue({dataVenda:this.formatDateForInput(new Date().toISOString()),rentabilidadeFinal:t.rentabilidadeAtual||0}),this.showEncerrarModal.set(!0)}confirmarEncerrar(){if(this.encerrarForm.invalid){this.toastService.warning("Preencha todos os campos");return}let t=this.aplicacaoToEncerrar();if(!t)return;this.loading.set(!0),this.showEncerrarModal.set(!1);let{dataVenda:o,rentabilidadeFinal:r}=this.encerrarForm.value,d=o.includes("T")?o:`${o}T00:00:00`;this.aplicacaoService.encerrarAplicacao(t.id,d,r).subscribe({next:()=>{this.loading.set(!1),this.toastService.success("Aplica\xE7\xE3o encerrada com sucesso!"),this.aplicacaoToEncerrar.set(null),this.carregarAplicacoes(),this.carregarCarteira()},error:p=>{this.loading.set(!1),this.toastService.error(p.error?.mensagem||"Erro ao encerrar aplica\xE7\xE3o")}})}cancelarEncerrar(){this.showEncerrarModal.set(!1),this.aplicacaoToEncerrar.set(null)}abrirModalExclusao(t){this.aplicacaoToDelete.set(t),this.showDeleteModal.set(!0)}confirmarExclusao(){let t=this.aplicacaoToDelete();t&&(this.loading.set(!0),this.showDeleteModal.set(!1),this.aplicacaoService.deletarAplicacao(t.id).subscribe({next:()=>{this.loading.set(!1),this.toastService.success("Aplica\xE7\xE3o exclu\xEDda!"),this.aplicacaoToDelete.set(null),this.carregarAplicacoes(),this.carregarCarteira()},error:o=>{this.loading.set(!1),this.toastService.error(o.error?.mensagem||"Erro ao excluir aplica\xE7\xE3o")}}))}cancelarExclusao(){this.showDeleteModal.set(!1),this.aplicacaoToDelete.set(null)}abrirModalLogout(){this.showLogoutModal.set(!0)}confirmarLogout(){this.showLogoutModal.set(!1),this.authService.logout()}cancelarLogout(){this.showLogoutModal.set(!1)}getTipoProdutoInfo(t){return this.tipoProdutoOptions.find(o=>o.value===t)}getStatusInfo(t){return this.statusOptions.find(o=>o.value===t)}formatarValor(t){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)}formatarPercentual(t){return`${t>=0?"+":""}${t.toFixed(2)}%`}formatarData(t){return new Date(t).toLocaleDateString("pt-BR")}formatDateForInput(t){return t.split("T")[0]}calcularLucro(t){return t.valorAplicado*(t.rentabilidadeAtual/100)}calcularValorAtual(t){return t.valorAplicado+this.calcularLucro(t)}get totalAplicado(){return this.aplicacoes().reduce((t,o)=>t+o.valorAplicado,0)}get totalAtual(){return this.aplicacoes().reduce((t,o)=>t+this.calcularValorAtual(o),0)}get rentabilidadeGeral(){return this.totalAplicado===0?0:(this.totalAtual-this.totalAplicado)/this.totalAplicado*100}get aplicacoesAtivas(){return this.aplicacoes().filter(t=>t.status==="ATIVA").length}get aplicacoesEncerradas(){return this.aplicacoes().filter(t=>t.status==="ENCERRADA").length}atualizarValidacaoCodigoAtivo(t){let o=this.aplicacaoForm.get("codigoAtivo");if(o){switch(o.clearValidators(),o.setValidators([s.required,s.minLength(2),s.maxLength(20)]),t){case"ACAO":o.addValidators(s.pattern(/^[A-Z]{4}\d{1,2}$/));break;case"FII":o.addValidators(s.pattern(/^[A-Z]{4}11$/));break;case"CDB":o.addValidators(s.pattern(/^CDB\d{3,6}$/));break;case"LCI":o.addValidators(s.pattern(/^LCI\d{3,6}$/));break;case"LCA":o.addValidators(s.pattern(/^LCA\d{3,6}$/));break;case"TESOURO_DIRETO":o.addValidators(s.pattern(/^(TESOURO|TS)\d{2,4}$/));break;case"FUNDO_INVESTIMENTO":o.addValidators(s.pattern(/^[A-Z]{2,6}\d{2,4}$/));break}o.updateValueAndValidity()}}atualizarValidacaoRentabilidade(t){let o=this.aplicacaoForm.get("rentabilidadeAtual");if(o){switch(o.clearValidators(),o.setValidators([s.min(-50)]),t){case"ACAO":o.addValidators(s.max(200));break;case"FII":o.addValidators(s.max(50));break;case"CDB":case"LCI":case"LCA":o.addValidators(s.max(25));break;case"TESOURO_DIRETO":o.addValidators(s.max(15));break;case"FUNDO_INVESTIMENTO":o.addValidators(s.max(100));break}o.updateValueAndValidity()}}static{this.\u0275fac=function(o){return new(o||n)(A(q),A(B),A(dt),A(st),A(ct),A(G),A(ot),A(at))}}static{this.\u0275cmp=R({type:n,selectors:[["app-carteira-detail"]],standalone:!0,features:[N],decls:28,vars:18,consts:[[1,"min-h-screen","bg-gray-50","flex","flex-col"],[1,"bg-white","shadow-sm","border-b","border-gray-200"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8"],[1,"flex","justify-between","items-center","h-20"],[1,"flex","items-center"],["src","assets/logo.png","alt","BartoFinance","routerLink","/dashboard",1,"h-16","w-auto","hover:opacity-80","transition-opacity","cursor-pointer"],[1,"hidden","md:flex","items-center","space-x-8"],["routerLink","/dashboard",1,"text-gray-600","hover:text-primary-600","transition"],["routerLink","/investidores",1,"text-gray-600","hover:text-primary-600","transition"],["routerLink","/carteiras",1,"text-gray-900","hover:text-primary-600","font-medium","transition"],[1,"flex","items-center","space-x-4"],[1,"text-sm","text-gray-700"],[1,"font-semibold"],[1,"btn-ghost","text-sm",3,"click"],[1,"flex-1","max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-8","w-full"],[1,"flex","justify-center","items-center","py-12"],[1,"fixed","inset-0","bg-gray-600","bg-opacity-75","flex","items-center","justify-center","z-50","animate-fade-in"],[3,"confirm","cancel","show","title","message","confirmText","cancelText","type","icon"],[1,"animate-spin","rounded-full","h-12","w-12","border-4","border-primary-500","border-t-transparent"],[1,"ml-4","text-primary-600"],[1,"mb-6","flex","items-center","text-sm","text-gray-600","animate-fade-in"],["routerLink","/carteiras",1,"hover:text-primary-600"],[1,"mx-2"],[1,"text-gray-900","font-medium"],[1,"card","mb-6","animate-slide-up"],[1,"flex","justify-between","items-start"],[1,"flex-1"],[1,"flex","items-center","gap-3","mb-3"],[1,"text-3xl","font-bold","text-gray-900"],[1,"text-gray-600","mb-4"],[1,"flex","items-center","gap-2","text-sm","text-gray-700","mb-2"],[1,"grid","grid-cols-2","gap-4","mt-4","text-sm","text-gray-600"],["routerLink","/carteiras",1,"btn-ghost"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6","mb-8"],[1,"card","animate-slide-up","animation-delay-200"],[1,"text-sm","font-medium","text-gray-600","mb-1"],[1,"text-2xl","font-bold","text-gray-900"],[1,"card","animate-slide-up","animation-delay-300"],[1,"text-2xl","font-bold","text-primary-600"],[1,"card","animate-slide-up","animation-delay-400"],[1,"text-xs","text-gray-500","mt-1"],[1,"card","animate-slide-up","animation-delay-500"],[1,"flex","items-baseline","gap-2"],[1,"text-xs","text-gray-500"],[1,"mb-6"],[1,"flex","justify-between","items-center","mb-4"],[1,"btn-primary","flex","items-center",3,"click"],[1,"mr-2"],[1,"card"],[1,"text-center","py-8","text-gray-500"],[1,"badge","bg-purple-100","text-purple-800"],[3,"class"],[1,"text-primary-600","hover:text-primary-800","font-medium",3,"routerLink"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-4","mb-4"],[1,"flex","items-start","gap-3"],[1,"text-2xl"],[1,"font-semibold","text-blue-900","mb-1"],[1,"text-sm","text-blue-800"],[1,"text-4xl","mb-4"],[1,"text-lg","font-medium"],[1,"text-sm","mt-2"],[1,"btn-primary","mt-6",3,"click"],[1,"overflow-x-auto"],[1,"min-w-full","divide-y","divide-gray-200"],[1,"bg-gray-50"],["scope","col",1,"px-6","py-3","text-left","text-xs","font-medium","text-gray-500","uppercase"],["scope","col",1,"px-6","py-3","text-right","text-xs","font-medium","text-gray-500","uppercase"],[1,"bg-white","divide-y","divide-gray-200"],[1,"hover:bg-gray-50","transition-colors"],[1,"px-6","py-4","whitespace-nowrap"],[1,"text-sm","font-medium","text-gray-900"],[1,"badge","bg-gray-100","text-gray-800"],[1,"text-sm","text-gray-900"],[1,"px-6","py-4","whitespace-nowrap","text-right","text-sm","font-medium"],["title","Excluir",1,"text-red-600","hover:text-red-900",3,"click"],["title","Editar",1,"text-primary-600","hover:text-primary-900","mr-3",3,"click"],["title","Encerrar",1,"text-yellow-600","hover:text-yellow-900","mr-3",3,"click"],[1,"bg-white","rounded-lg","shadow-xl","p-6","w-full","max-w-2xl","max-h-[90vh]","overflow-y-auto","animate-slide-up"],[1,"text-xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600",3,"click"],[1,"bg-blue-50","border-l-4","border-blue-500","p-3","mb-4"],[3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","mb-4"],["for","tipoProduto",1,"label"],["id","tipoProduto","formControlName","tipoProduto",1,"input"],["value","","disabled",""],[3,"value"],[1,"text-red-600","text-sm","mt-1"],["for","codigoAtivo",1,"label"],["id","codigoAtivo","type","text","formControlName","codigoAtivo","placeholder","Ex: PETR4 (a\xE7\xF5es), HGLG11 (FII), CDB001 (CDB)","maxlength","20",1,"input"],["for","valorAplicado",1,"label"],["id","valorAplicado","type","text","formControlName","valorAplicado","placeholder","R$ 0,00","appCurrencyMask","",1,"input"],["for","quantidade",1,"label"],["id","quantidade","type","number","formControlName","quantidade","placeholder","0","step","0.01","min","0.01",1,"input"],["for","dataCompra",1,"label"],["id","dataCompra","type","date","formControlName","dataCompra",1,"input"],["for","rentabilidadeAtual",1,"label"],["id","rentabilidadeAtual","type","number","formControlName","rentabilidadeAtual","placeholder","0.00","step","0.01","min","-50","max","200",1,"input"],[1,"md:col-span-2"],["for","notas",1,"label"],["id","notas","formControlName","notas","rows","2","placeholder","Observa\xE7\xF5es sobre esta aplica\xE7\xE3o...",1,"input"],[1,"flex","justify-end","space-x-4","mt-6"],["type","button",1,"btn-secondary",3,"click"],["type","submit",1,"btn-primary",3,"disabled"],[1,"flex","items-center","gap-2"],[1,"text-blue-600"],[1,"bg-white","rounded-lg","shadow-xl","p-6","w-full","max-w-md","animate-slide-up"],[1,"mb-4","p-4","bg-yellow-50","border","border-yellow-200","rounded-lg"],[1,"text-sm","text-yellow-800","mb-2"],[1,"text-sm","text-yellow-800"],[1,"mb-4"],["for","dataVenda",1,"label"],["id","dataVenda","type","date","formControlName","dataVenda",1,"input"],["for","rentabilidadeFinal",1,"label"],["id","rentabilidadeFinal","type","number","formControlName","rentabilidadeFinal","placeholder","0.00","step","0.01",1,"input"],[1,"flex","justify-end","space-x-4"],["type","submit",1,"bg-yellow-600","text-white","px-4","py-2","rounded-lg","hover:bg-yellow-700","transition"]],template:function(o,r){if(o&1&&(i(0,"div",0)(1,"nav",1)(2,"div",2)(3,"div",3)(4,"div",4),E(5,"img",5),e(),i(6,"div",6)(7,"a",7),a(8,"Dashboard"),e(),i(9,"a",8),a(10,"Investidores"),e(),i(11,"a",9),a(12,"Carteiras"),e()(),i(13,"div",10)(14,"span",11),a(15,"Ol\xE1, "),i(16,"span",12),a(17),e()(),i(18,"button",13),C("click",function(){return r.abrirModalLogout()}),a(19,"Sair"),e()()()()(),i(20,"main",14),x(21,vt,4,0,"div",15)(22,Rt,1,1),e(),x(23,Wt,61,11,"div",16)(24,Yt,8,1,"div",16),E(25,"app-footer"),i(26,"app-confirm-modal",17),C("confirm",function(){return r.confirmarExclusao()})("cancel",function(){return r.cancelarExclusao()}),e(),i(27,"app-confirm-modal",17),C("confirm",function(){return r.confirmarLogout()})("cancel",function(){return r.cancelarLogout()}),e()()),o&2){let d;l(17),v(r.userName()),l(4),u(21,r.loading()&&!r.carteira()?21:r.carteira()?22:-1),l(2),u(23,r.showAplicacaoModal()?23:-1),l(),u(24,r.showEncerrarModal()?24:-1),l(2),D("show",r.showDeleteModal())("title","Excluir Aplica\xE7\xE3o")("message","Tem certeza que deseja excluir a aplica\xE7\xE3o "+(((d=r.aplicacaoToDelete())==null?null:d.codigoAtivo)||"")+"? Esta a\xE7\xE3o n\xE3o pode ser desfeita.")("confirmText","Excluir")("cancelText","Cancelar")("type","danger")("icon","\u{1F5D1}\uFE0F"),l(),D("show",r.showLogoutModal())("title","Sair do Sistema")("message","Voc\xEA deseja realmente sair do sistema? Voc\xEA precisar\xE1 fazer login novamente para acessar.")("confirmText","Sair")("cancelText","Cancelar")("type","warning")("icon","\u{1F44B}")}},dependencies:[$,j,rt,nt,Z,X,Y,z,H,W,U,Q,it,et,tt,J,K,lt,mt]})}}return n})();export{he as CarteiraDetailComponent};
